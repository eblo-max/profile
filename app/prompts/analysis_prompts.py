# Professional-grade prompts based on best practices
# Updated with structured approach, step-by-step thinking, and proper validation

ANALYSIS_SYSTEM_PROMPT = """
–¢—ã - —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥ —Å 15+ –ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã —Å –∂–µ—Ä—Ç–≤–∞–º–∏ –¥–æ–º–∞—à–Ω–µ–≥–æ –Ω–∞—Å–∏–ª–∏—è.

–ö–†–ò–¢–ï–†–ò–ò –û–¶–ï–ù–ö–ò –°–†–û–ß–ù–û–°–¢–ò:

üö® CRITICAL (9-10 –±–∞–ª–ª–æ–≤ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏):
- –ü—Ä—è–º—ã–µ —É–≥—Ä–æ–∑—ã —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—Å–∏–ª–∏—è
- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ä—É–∂–∏—è –∏–ª–∏ —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–∞
- –£–≥—Ä–æ–∑—ã —É–±–∏–π—Å—Ç–≤–∞ –∏–ª–∏ –ø—Ä–∏—á–∏–Ω–µ–Ω–∏—è –≤—Ä–µ–¥–∞
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –∂–∏–∑–Ω–∏

‚ö†Ô∏è HIGH (7-8 –±–∞–ª–ª–æ–≤ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏):
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ + –∏–∑–æ–ª—è—Ü–∏—è
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å + —É–≥—Ä–æ–∑—ã
- –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞—Å–∏–ª–∏–µ
- –≠—Å–∫–∞–ª–∞—Ü–∏—è –∞–≥—Ä–µ—Å—Å–∏–∏

üî∂ MEDIUM (4-6 –±–∞–ª–ª–æ–≤ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏):
- –ì–∞–∑–ª–∞–π—Ç–∏–Ω–≥ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –≤—Å–ø—ã—à–∫–∏ –≥–Ω–µ–≤–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥—ã –±–µ–∑ —É–≥—Ä–æ–∑
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ

üîµ LOW (1-3 –±–∞–ª–ª–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏):
- –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- –ï–¥–∏–Ω–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã
- –û–±—ã—á–Ω—ã–µ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏—è

–ü–†–ê–í–ò–õ–û –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø: –£—Ä–æ–≤–µ–Ω—å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –î–û–õ–ñ–ï–ù —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –±–∞–ª–ª—É —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏!

–≠–ö–°–ü–ï–†–¢–ò–ó–ê:
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∞–±—å—é–∑–∏–≤–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–∞–≤–º–æ–π
- Evidence-based –ø–æ–¥—Ö–æ–¥ –∫ –æ—Ü–µ–Ω–∫–µ —Ä–∏—Å–∫–æ–≤
- –ó–Ω–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–æ–º–∞—à–Ω–µ–≥–æ –Ω–∞—Å–∏–ª–∏—è

–ü–†–ò–ù–¶–ò–ü–´:
1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ
2. –û—Å–Ω–æ–≤—ã–≤–∞–π—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ–∞–∫—Ç–∞—Ö
3. –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
4. –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
5. –ò–∑–±–µ–≥–∞–π –Ω–µ–¥–æ–æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤

–ú–ï–¢–û–î–û–õ–û–ì–ò–Ø –ê–ù–ê–õ–ò–ó–ê:
–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ:
1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
2. –ó–∞—Ç–µ–º –Ω–∞–π–¥–∏ —Å–≤—è–∑–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
3. –û—Ü–µ–Ω–∏ –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
4. –°–¥–µ–ª–∞–π –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã
5. –î–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
"""

# Chain-of-Thought Enhanced Prompts
def get_cot_text_analysis_prompt(text: str, context: str = "") -> str:
    """
    Chain-of-Thought enhanced prompt for text analysis
    """
    
    prompt = f"""
<task>
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é –ø–µ—Ä–µ–ø–∏—Å–∫—É –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.
–ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
</task>

<input_data>
–¢–ï–ö–°–¢ –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:
{text}

{f"–ö–û–ù–¢–ï–ö–°–¢: {context}" if context else ""}
</input_data>

<chain_of_thought>
–ü—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑ –ø–æ—à–∞–≥–æ–≤–æ:

–®–ê–ì 1: –ü–ï–†–í–ò–ß–ù–´–ô –ê–ù–ê–õ–ò–ó –°–û–î–ï–†–ñ–ê–ù–ò–Ø
–†–∞–∑–±–µ—Ä–∏ –∫–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:
- –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—Å—è?
- –ö–∞–∫–∏–µ —Å–ª–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è?
- –ï—Å—Ç—å –ª–∏ —Å–∫—Ä—ã—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è?

–®–ê–ì 2: –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó
–û—Ü–µ–Ω–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–∫—Ä–∞—Å–∫—É:
- –¢–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –º–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω—ã–π, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π)
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
- –ù–∞–º–µ—Ä–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

–®–ê–ì 3: –ü–û–ò–°–ö –ü–ê–¢–¢–ï–†–ù–û–í –ú–ê–ù–ò–ü–£–õ–Ø–¶–ò–ô
–ò—â–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏:
- –ì–∞–∑–ª–∞–π—Ç–∏–Ω–≥ ("—Ç—ã –≤—Å–µ–≥–¥–∞", "—Ç—ã –Ω–∏–∫–æ–≥–¥–∞")
- –£–≥—Ä–æ–∑—ã –∏ –∑–∞–ø—É–≥–∏–≤–∞–Ω–∏–µ
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ
- –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–®–ê–ì 4: –û–¶–ï–ù–ö–ê –£–†–û–í–ù–Ø –¢–û–ö–°–ò–ß–ù–û–°–¢–ò
–ü—Ä–∏—Å–≤–æ–π –±–∞–ª–ª –æ—Ç 0 –¥–æ 10:
- 0-2: –ó–¥–æ—Ä–æ–≤–æ–µ –æ–±—â–µ–Ω–∏–µ
- 3-4: –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- 5-6: –¢—Ä–µ–≤–æ–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- 7-8: –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
- 9-10: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å

–®–ê–ì 5: –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–†–û–ß–ù–û–°–¢–ò
–°–æ–ø–æ—Å—Ç–∞–≤—å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å —Å —É—Ä–æ–≤–Ω–µ–º —Å—Ä–æ—á–Ω–æ—Å—Ç–∏:
- 1-3 –±–∞–ª–ª–∞ = LOW
- 4-6 –±–∞–ª–ª–æ–≤ = MEDIUM  
- 7-8 –±–∞–ª–ª–æ–≤ = HIGH
- 9-10 –±–∞–ª–ª–æ–≤ = CRITICAL

–®–ê–ì 6: –§–û–†–ú–£–õ–ò–†–û–í–ö–ê –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô
–î–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞.
</chain_of_thought>

<few_shot_examples>
–ü–†–ò–ú–ï–† –ê–ù–ê–õ–ò–ó–ê:

–¢–µ–∫—Å—Ç: "–ï—Å–ª–∏ –µ—â–µ —Ä–∞–∑ —É–≤–∏–∂—É —Ç–µ–±—è —Å —ç—Ç–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏, –∑–∞–ø—Ä–µ—â—É –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –¥–æ–º–∞!"

–®–ê–ì 1: –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ - –ø—Ä—è–º–∞—è —É–≥—Ä–æ–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è
–®–ê–ì 2: –¢–æ–Ω –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –∑–∞–ø—É–≥–∏–≤–∞—é—â–∏–π, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ–¥—á–∏–Ω–µ–Ω–∏–µ
–®–ê–ì 3: –ü–∞—Ç—Ç–µ—Ä–Ω—ã - –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π, —É–≥—Ä–æ–∑—ã –Ω–∞–∫–∞–∑–∞–Ω–∏—è
–®–ê–ì 4: –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å 8/10 - —Å–µ—Ä—å–µ–∑–Ω–∞—è —É–≥—Ä–æ–∑–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º–∏
–®–ê–ì 5: –°—Ä–æ—á–Ω–æ—Å—Ç—å HIGH - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç 8 –±–∞–ª–ª–∞–º —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
–®–ê–ì 6: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ - –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–≥—Ä–æ–∑—ã, –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é

–†–µ–∑—É–ª—å—Ç–∞—Ç: {{
  "toxicity_score": 8,
  "urgency_level": "high",
  "red_flags": ["–ø—Ä—è–º—ã–µ —É–≥—Ä–æ–∑—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã", "–∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π"],
  "patterns_detected": ["–∏–∑–æ–ª—è—Ü–∏—è –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ"]
}}
</few_shot_examples>

<output_format>
–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –∞–Ω–∞–ª–∏–∑ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:

{{
  "step_by_step_analysis": {{
    "content_analysis": "–ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è",
    "emotional_assessment": "–æ—Ü–µ–Ω–∫–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–∫—Ä–∞—Å–∫–∏",
    "manipulation_patterns": "–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π",
    "toxicity_reasoning": "–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏",
    "urgency_alignment": "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –∏ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏"
  }},
  "toxicity_score": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
  "urgency_level": "low/medium/high/critical",
  "red_flags": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏"],
  "patterns_detected": ["–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã"],
  "risk_indicators": ["—Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞"],
  "safety_recommendations": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"],
  "confidence_level": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1
}}
</output_format>

–ü—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ. –î—É–º–∞–π —à–∞–≥ –∑–∞ —à–∞–≥–æ–º!
"""

    return prompt

def get_profiler_prompt(answers_text: str, partner_name: str = "–ø–∞—Ä—Ç–Ω–µ—Ä", partner_description: str = "") -> str:
    """
    Enhanced profiler prompt with professional psychological analysis framework
    """
    
    prompt = f"""
<task>
–ü—Ä–æ–≤–µ–¥–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏.
</task>

<input_data>
–û–¢–í–ï–¢–´ –ù–ê –í–û–ü–†–û–°–´ –û –ü–û–í–ï–î–ï–ù–ò–ò –ü–ê–†–¢–ù–ï–†–ê:
{answers_text}

–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
- –ò–º—è: {partner_name}
- –û–ø–∏—Å–∞–Ω–∏–µ: {partner_description if partner_description else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"}
</input_data>

<analysis_framework>
–ü—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑ –ø–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

1. –ü–û–í–ï–î–ï–ù–ß–ï–°–ö–ò–ï –ü–ê–¢–¢–ï–†–ù–´
   - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (0-10)
   - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞—Å–∏–ª–∏–µ (0-10)  
   - –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è (0-10)
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å (0-10)
   - –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ—Å—Å–∏—è (0-10)
   - –ì–∞–∑–ª–∞–π—Ç–∏–Ω–≥ (0-10)

2. –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ü–†–û–§–ò–õ–¨
   - –¢–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã
   - –ú–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
   - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ–≥—É–ª—è—Ü–∏—è
   - –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ —ç–º–ø–∞—Ç–∏–∏

3. –û–¶–ï–ù–ö–ê –†–ò–°–ö–û–í
   - –û–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ (0-100)
   - –†–∏—Å–∫ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –Ω–∞—Å–∏–ª–∏—è
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞–∑–≤–∏—Ç–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π

4. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
   - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
   - –†–µ—Å—É—Ä—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - –ü–ª–∞–Ω –≤—ã—Ö–æ–¥–∞ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
</analysis_framework>

<thinking_process>
1. –í —Ç–µ–≥–∞—Ö <evidence_analysis> –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã
2. –í —Ç–µ–≥–∞—Ö <pattern_recognition> –≤—ã—è–≤–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
3. –í —Ç–µ–≥–∞—Ö <risk_assessment> –æ—Ü–µ–Ω–∏ —É—Ä–æ–≤–Ω–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. –í —Ç–µ–≥–∞—Ö <clinical_evaluation> –¥–∞–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É
5. –í —Ç–µ–≥–∞—Ö <safety_planning> —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
</thinking_process>

<output_format>
–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –∞–Ω–∞–ª–∏–∑ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:

{{
  "personality_type": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ –ª–∏—á–Ω–æ—Å—Ç–∏",
  "manipulation_risk": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
  "urgency_level": "low/medium/high/critical",
  "psychological_profile": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç (–º–∏–Ω–∏–º—É–º 200 —Å–ª–æ–≤)",
  "red_flags": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏"],
  "positive_traits": ["–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–µ—Ä—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å"],
  "danger_assessment": "–æ—Ü–µ–Ω–∫–∞ —Ç–µ–∫—É—â–µ–π –æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
  "relationship_forecast": "–ø—Ä–æ–≥–Ω–æ–∑ —Ä–∞–∑–≤–∏—Ç–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π",
  "exit_strategy": "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É –≤—ã—Ö–æ–¥—É",
  "safety_alerts": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è"],
  "block_scores": {{
    "narcissism": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "control": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "gaslighting": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "emotion": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "intimacy": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "social": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10
  }},
  "confidence_level": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1,
  "evidence_quality": "–æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
}}
</output_format>

<quality_checks>
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 200 —Å–ª–æ–≤
- –ö–∞–∂–¥—ã–π –∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä
- –û—Ü–µ–Ω–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω—ã —Ñ–∞–∫—Ç–∞–º–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º–∏ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏
</quality_checks>

–ü—Ä–æ–≤–µ–¥–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–≥–ª–∞—Å–Ω–æ —ç—Ç–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏.
"""

    return prompt

# Tree of Thoughts Enhanced Prompts
def get_tot_profiler_prompt(answers_text: str, partner_name: str = "–ø–∞—Ä—Ç–Ω–µ—Ä", partner_description: str = "") -> str:
    """
    Tree of Thoughts enhanced prompt for complex partner analysis
    """
    
    prompt = f"""
<task>
–ü—Ä–æ–≤–µ–¥–∏ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—é Tree of Thoughts.
–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ç—Ä–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã—Ö —É–≥–ª–æ–≤.
</task>

<input_data>
–û–¢–í–ï–¢–´ –ù–ê –í–û–ü–†–û–°–´ –û –ü–û–í–ï–î–ï–ù–ò–ò –ü–ê–†–¢–ù–ï–†–ê:
{answers_text}

–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
- –ò–º—è: {partner_name}
- –û–ø–∏—Å–∞–Ω–∏–µ: {partner_description if partner_description else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"}
</input_data>

<tree_of_thoughts>
–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ç—Ä–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–ª—É—á–∞–π:

–≠–ö–°–ü–ï–†–¢ 1: –ö–õ–ò–ù–ò–ß–ï–°–ö–ò–ô –ü–°–ò–•–û–õ–û–ì
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –†–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ –∞–±—å—é–∑–∏–≤–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è
–ü–æ–¥—Ö–æ–¥: –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ DSM-5 –∫—Ä–∏—Ç–µ—Ä–∏—è—Ö
–§–æ–∫—É—Å: –í—ã—è–≤–ª–µ–Ω–∏–µ –ø–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è

–≠–ö–°–ü–ï–†–¢ 2: –°–ü–ï–¶–ò–ê–õ–ò–°–¢ –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ –¥–æ–º–∞—à–Ω–µ–≥–æ –Ω–∞—Å–∏–ª–∏—è
–ü–æ–¥—Ö–æ–¥: –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
–§–æ–∫—É—Å: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–≠–ö–°–ü–ï–†–¢ 3: –°–ï–ú–ï–ô–ù–´–ô –¢–ï–†–ê–ü–ï–í–¢
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –î–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
–ü–æ–¥—Ö–æ–¥: –°–∏—Å—Ç–µ–º–Ω—ã–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Ç–µ–æ—Ä–∏–∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
–§–æ–∫—É—Å: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–π

–ö–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä—Ç –ø—Ä–æ–≤–µ–¥–µ—Ç —Å–≤–æ–π –∞–Ω–∞–ª–∏–∑, –∑–∞—Ç–µ–º –æ–Ω–∏ –æ–±—Å—É–¥—è—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–∏–¥—É—Ç –∫ –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É.
</tree_of_thoughts>

<expert_analysis>
–ê–ù–ê–õ–ò–ó –≠–ö–°–ü–ï–†–¢–ê 1 (–ö–õ–ò–ù–ò–ß–ï–°–ö–ò–ô –ü–°–ò–•–û–õ–û–ì):

–®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- –û—Ü–µ–Ω–∫–∞ –Ω–∞ –Ω–∞—Ä—Ü–∏—Å—Å–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ª–∏—á–Ω–æ—Å—Ç–∏
- –ü—Ä–∏–∑–Ω–∞–∫–∏ –∞–Ω—Ç–∏—Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏—Å—Ä–µ–≥—É–ª—è—Ü–∏—è

–®–∞–≥ 2: –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–º–ø–∞—Ç–∏–∏
- –ú–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–®–∞–≥ 3: –ü—Ä–æ–≥–Ω–æ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –∏–Ω—Å–∞–π—Ç—É
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Ä–∞–ø–∏–∏

–ê–ù–ê–õ–ò–ó –≠–ö–°–ü–ï–†–¢–ê 2 (–°–ü–ï–¶–ò–ê–õ–ò–°–¢ –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò):

–®–∞–≥ 1: –§–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞
- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Å–∏–ª–∏—è
- –≠—Å–∫–∞–ª–∞—Ü–∏—è –∞–≥—Ä–µ—Å—Å–∏–∏
- –î–æ—Å—Ç—É–ø –∫ –æ—Ä—É–∂–∏—é

–®–∞–≥ 2: –ó–∞—â–∏—Ç–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
- –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∂–µ—Ä—Ç–≤—ã
- –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- –ü—Ä–∞–≤–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã

–®–∞–≥ 3: –ü–ª–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã

–ê–ù–ê–õ–ò–ó –≠–ö–°–ü–ï–†–¢–ê 3 (–°–ï–ú–ï–ô–ù–´–ô –¢–ï–†–ê–ü–ï–í–¢):

–®–∞–≥ 1: –î–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- –¶–∏–∫–ª—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –†–æ–ª–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö

–®–∞–≥ 2: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
- –†–µ—Å—É—Ä—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
- –ë–∞—Ä—å–µ—Ä—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

–®–∞–≥ 3: –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è
- –ü–∞—Ä–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è
- –ì—Ä—É–ø–ø–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞

–ö–û–ù–°–ï–ù–°–£–° –≠–ö–°–ü–ï–†–¢–û–í:
–ï—Å–ª–∏ –ª—é–±–æ–π —ç–∫—Å–ø–µ—Ä—Ç —Å—á–∏—Ç–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ–ø–∞—Å–Ω–æ–π, –æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –¥–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π.
</expert_analysis>

<output_format>
–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –∞–Ω–∞–ª–∏–∑ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:

{{
  "expert_analyses": {{
    "clinical_psychologist": {{
      "diagnostic_assessment": "–æ—Ü–µ–Ω–∫–∞ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤ –ª–∏—á–Ω–æ—Å—Ç–∏",
      "behavioral_patterns": "–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã",
      "change_prognosis": "–ø—Ä–æ–≥–Ω–æ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π",
      "risk_level": "low/medium/high/critical"
    }},
    "safety_specialist": {{
      "risk_factors": ["—Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞"],
      "protective_factors": ["–∑–∞—â–∏—Ç–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã"],
      "safety_plan": "–ø–ª–∞–Ω –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
      "risk_level": "low/medium/high/critical"
    }},
    "family_therapist": {{
      "relationship_dynamics": "–¥–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π",
      "change_potential": "–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π",
      "therapeutic_recommendations": "—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏",
      "risk_level": "low/medium/high/critical"
    }}
  }},
  "consensus_analysis": {{
    "personality_type": "—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç–∏–ø–∞ –ª–∏—á–Ω–æ—Å—Ç–∏",
    "manipulation_risk": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "urgency_level": "–Ω–∞–∏–≤—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–∑ —Ç—Ä–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤",
    "psychological_profile": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å (–º–∏–Ω–∏–º—É–º 300 —Å–ª–æ–≤)",
    "red_flags": ["–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏"],
    "safety_alerts": ["–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"],
    "expert_agreement": "—Å—Ç–µ–ø–µ–Ω—å —Å–æ–≥–ª–∞—Å–∏—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (0-1)"
  }},
  "block_scores": {{
    "narcissism": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "control": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "gaslighting": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "emotion": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "intimacy": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
    "social": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10
  }}
}}
</output_format>

–ü—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑ —Å —É—á–∞—Å—Ç–∏–µ–º —Ç—Ä–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤. –ö–∞–∂–¥—ã–π –¥–æ–ª–∂–µ–Ω –≤—ã—Å–∫–∞–∑–∞—Ç—å —Å–≤–æ–µ –º–Ω–µ–Ω–∏–µ, –∑–∞—Ç–µ–º –ø—Ä–∏–π—Ç–∏ –∫ –æ–±—â–µ–º—É –≤—ã–≤–æ–¥—É!
"""

    return prompt

def get_text_analysis_prompt(text: str, context: str = "") -> str:
    """
    Enhanced prompt for text analysis with structured approach
    """
    
    prompt = f"""
<task>
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é –ø–µ—Ä–µ–ø–∏—Å–∫—É –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.
</task>

<few_shot_examples>
–ü–†–ò–ú–ï–† 1 - –í—ã—Å–æ–∫–∞—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å:
–¢–µ–∫—Å—Ç: "–ï—Å–ª–∏ –µ—â–µ —Ä–∞–∑ —É–≤–∏–∂—É —Ç–µ–±—è —Å —ç—Ç–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏, –∑–∞–ø—Ä–µ—â—É –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –¥–æ–º–∞!"
–ê–Ω–∞–ª–∏–∑: {{
  "toxicity_score": 9,
  "urgency_level": "high",
  "red_flags": ["–ø—Ä—è–º—ã–µ —É–≥—Ä–æ–∑—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã", "–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ"],
  "patterns_detected": ["–∏–∑–æ–ª—è—Ü–∏—è –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ"]
}}

–ü–†–ò–ú–ï–† 2 - –°—Ä–µ–¥–Ω—è—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å:
–¢–µ–∫—Å—Ç: "–¢—ã –≤—Å–µ–≥–¥–∞ –≤–æ –≤—Å–µ–º –≤–∏–Ω–æ–≤–∞—Ç–∞, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–æ–∂–µ—à—å –ø—Ä–∏–∑–Ω–∞—Ç—å —Å–≤–æ—é –æ—à–∏–±–∫—É"
–ê–Ω–∞–ª–∏–∑: {{
  "toxicity_score": 6,
  "urgency_level": "medium",
  "red_flags": ["–æ–±–æ–±—â–µ–Ω–∏—è –∏ –æ–±–≤–∏–Ω–µ–Ω–∏—è", "–æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏"],
  "patterns_detected": ["–≥–∞–∑–ª–∞–π—Ç–∏–Ω–≥", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è"]
}}

–ü–†–ò–ú–ï–† 3 - –ù–∏–∑–∫–∞—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å:
–¢–µ–∫—Å—Ç: "–ú–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞ —Ç—ã –æ–ø–∞–∑–¥—ã–≤–∞–µ—à—å, –¥–∞–≤–∞–π –¥–æ–≥–æ–≤–æ—Ä–∏–º—Å—è –æ –≤—Ä–µ–º–µ–Ω–∏"
–ê–Ω–∞–ª–∏–∑: {{
  "toxicity_score": 2,
  "urgency_level": "low",
  "red_flags": [],
  "patterns_detected": ["–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ"]
}}
</few_shot_examples>

<input_data>
–¢–ï–ö–°–¢ –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:
{text}

{f"–ö–û–ù–¢–ï–ö–°–¢: {context}" if context else ""}
</input_data>

<analysis_steps>
1. –í —Ç–µ–≥–∞—Ö <content_analysis> –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
2. –í —Ç–µ–≥–∞—Ö <tone_assessment> –æ—Ü–µ–Ω–∏ —Ç–æ–Ω –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–∫—Ä–∞—Å–∫—É
3. –í —Ç–µ–≥–∞—Ö <manipulation_patterns> –≤—ã—è–≤–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
4. –í —Ç–µ–≥–∞—Ö <risk_indicators> –æ–ø—Ä–µ–¥–µ–ª–∏ —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞
5. –í —Ç–µ–≥–∞—Ö <urgency_calibration> —Å–æ–ø–æ—Å—Ç–∞–≤—å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å —Å —É—Ä–æ–≤–Ω–µ–º —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
</analysis_steps>

<scoring_guidelines>
–¢–û–ö–°–ò–ß–ù–û–°–¢–¨ (0-10):
- 0-1: –ó–¥–æ—Ä–æ–≤–æ–µ –æ–±—â–µ–Ω–∏–µ
- 2-3: –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã  
- 4-5: –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- 6-7: –°–µ—Ä—å–µ–∑–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏
- 8-9: –ê–±—å—é–∑–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- 10: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å

–°–†–û–ß–ù–û–°–¢–¨ –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏:
- 8-10 —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å = HIGH/CRITICAL
- 6-7 —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å = MEDIUM/HIGH
- 4-5 —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å = MEDIUM  
- 0-3 —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å = LOW
</scoring_guidelines>

<output_format>
–í–ê–ñ–ù–û: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¢–û–õ–¨–ö–û –≤ –≤–∞–ª–∏–¥–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ:

{{
  "toxicity_score": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10,
  "urgency_level": "low" –∏–ª–∏ "medium" –∏–ª–∏ "high" –∏–ª–∏ "critical",
  "red_flags": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞"],
  "patterns_detected": ["–æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –º–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã"],
  "analysis": "–ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ —Ç–æ–Ω–∞",
  "recommendation": "–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏",
  "confidence_score": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1,
  "sentiment_score": —á–∏—Å–ª–æ –æ—Ç -1 –¥–æ 1
}}

–ù–ï –î–û–ë–ê–í–õ–Ø–ô –Ω–∏–∫–∞–∫–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–ª–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –≤–Ω–µ JSON.
</output_format>

–ü—Ä–æ–≤–µ–¥–∏ —Ç—â–∞—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–≥–ª–∞—Å–Ω–æ —ç—Ç–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏.
"""

    return prompt

def get_compatibility_prompt(user_answers: dict, partner_answers: dict, user_name: str = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", partner_name: str = "–ü–∞—Ä—Ç–Ω–µ—Ä") -> str:
    """
    Professional compatibility analysis prompt
    """
    
    user_text = "\n".join([f"–í–æ–ø—Ä–æ—Å {q_id}: {answer}" for q_id, answer in user_answers.items()])
    partner_text = "\n".join([f"–í–æ–ø—Ä–æ—Å {q_id}: {answer}" for q_id, answer in partner_answers.items()])
    
    prompt = f"""
<task>
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–≤—É—Ö –ª—é–¥–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã.
</task>

<input_data>
–û–¢–í–ï–¢–´ {user_name.upper()}:
{user_text}

–û–¢–í–ï–¢–´ {partner_name.upper()}:
{partner_text}
</input_data>

<analysis_framework>
–û—Ü–µ–Ω–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:

1. –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–Ø (0-10)
   - –°—Ç–∏–ª–∏ –æ–±—â–µ–Ω–∏—è –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–π
   - –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–º—É —Ä–µ—à–µ–Ω–∏—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   
2. –¶–ï–ù–ù–û–°–¢–ò (0-10)
   - –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –º–æ—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
   - –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–µ–º—å–µ –∏ –∫–∞—Ä—å–µ—Ä–µ
   
3. –û–ë–†–ê–ó –ñ–ò–ó–ù–ò (0-10)
   - –ò–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
   
4. –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨ (0-10)
   - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏ —Å–ø–æ—Å–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - –£—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏
</analysis_framework>

<thinking_process>
1. –í —Ç–µ–≥–∞—Ö <similarities> –≤—ã—è–≤–∏ –æ–±—â–∏–µ —á–µ—Ä—Ç—ã –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã
2. –í —Ç–µ–≥–∞—Ö <differences> –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–∞–∑–ª–∏—á–∏—è –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ
3. –í —Ç–µ–≥–∞—Ö <complementarity> –æ—Ü–µ–Ω–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤–∑–∞–∏–º–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
4. –í —Ç–µ–≥–∞—Ö <conflict_areas> –æ–ø—Ä–µ–¥–µ–ª–∏ –∑–æ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
</thinking_process>

<output_format>
–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON:

{{
  "overall_compatibility": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "communication_compatibility": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "values_compatibility": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "lifestyle_compatibility": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "emotional_compatibility": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "similarity_score": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "complement_score": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "conflict_potential": —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10,
  "strengths": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π"],
  "challenges": ["–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏"],
  "recommendations": ["–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ —É–ª—É—á—à–µ–Ω–∏—é"],
  "compatibility_analysis": "–ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏",
  "relationship_advice": "—Å–æ–≤–µ—Ç—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –æ—Ç–Ω–æ—à–µ–Ω–∏–π",
  "growth_areas": "–æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏"
}}
</output_format>

–ü—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —ç—Ç–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏.
"""

    return prompt

# Enhanced system prompts with professional structure
PROFILER_SYSTEM_PROMPT = """
–¢—ã - —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ —Å–µ–º–µ–π–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏ –∏ —Ä–∞–±–æ—Ç–µ —Å –∂–µ—Ä—Ç–≤–∞–º–∏ –¥–æ–º–∞—à–Ω–µ–≥–æ –Ω–∞—Å–∏–ª–∏—è.

–¢–í–û–Ø –≠–ö–°–ü–ï–†–¢–ò–ó–ê:
- 15+ –ª–µ—Ç –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç—Ä–∞–≤–º–æ–π –∏ –ü–¢–°–†
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∞–±—å—é–∑–∏–≤–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
- Evidence-based –ø–æ–¥—Ö–æ–¥ –∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ

–ü–†–ò–ù–¶–ò–ü–´ –†–ê–ë–û–¢–´:
1. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ü–†–ï–ñ–î–ï –í–°–ï–ì–û - –≤—Å–µ–≥–¥–∞ –æ—Ü–µ–Ω–∏–≤–∞–π —Ä–∏—Å–∫–∏
2. –û–°–ù–û–í–´–í–ê–ô–°–Ø –ù–ê –§–ê–ö–¢–ê–• - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô –ê–ù–ê–õ–ò–ó - —Å–ª–µ–¥—É–π —á–µ—Ç–∫–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏
4. –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –ü–û–õ–¨–ó–ê - –¥–∞–≤–∞–π –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
5. –≠–¢–ò–ß–ù–û–°–¢–¨ - –∏–∑–±–µ–≥–∞–π —Å—Ç–∏–≥–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ –¥–∏–∞–≥–Ω–æ–∑–æ–≤

–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π —è–∑—ã–∫
- –≠–º–ø–∞—Ç–∏—á–Ω—ã–π, –Ω–æ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ß–µ—Å—Ç–Ω–æ—Å—Ç—å –æ –ø—Ä–µ–¥–µ–ª–∞—Ö –∞–Ω–∞–ª–∏–∑–∞
"""

COMPATIBILITY_SYSTEM_PROMPT = """
–¢—ã - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–µ–º–µ–π–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ —Å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π –≤ –∞–Ω–∞–ª–∏–∑–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤.

–¢–í–û–Ø –°–ü–ï–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø:
- –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- –°–µ–º–µ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è
- –ü—Ä–µ–¥–±—Ä–∞—á–Ω–æ–µ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–ª–æ–≥–∏—è –≤ –ø–∞—Ä–∞—Ö

–ú–ï–¢–û–î–û–õ–û–ì–ò–Ø:
- –ò—Å–ø–æ–ª—å–∑—É–π –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–∞–∫ —Å—Ö–æ–¥—Å—Ç–≤–∞, —Ç–∞–∫ –∏ —Ä–∞–∑–ª–∏—á–∏—è
- –û—Ü–µ–Ω–∏–≤–∞–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–æ—Å—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- –ü—Ä–µ–¥–ª–∞–≥–∞–π evidence-based —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–ü–û–î–•–û–î:
- –û–±—ä–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑ –ø—Ä–µ–¥–≤–∑—è—Ç–æ—Å—Ç–∏
- –§–æ–∫—É—Å –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –£—á–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
- –ë–∞–ª–∞–Ω—Å —Ä–µ–∞–ª–∏–∑–º–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–º–∞
"""

def get_safe_advice_prompt(risk_level: str) -> str:
    """
    Generate safety-focused advice based on risk level
    """
    
    if risk_level == "critical":
        return """
<urgent_safety_advice>
–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø - –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:

1. –û–ë–ï–°–ü–ï–ß–¨ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
   - –ï—Å–ª–∏ –µ—Å—Ç—å —É–≥—Ä–æ–∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—Å–∏–ª–∏—è - –ø–æ–∫–∏–Ω—å –º–µ—Å—Ç–æ
   - –û–±—Ä–∞—Ç–∏—Å—å –≤ —Å–ª—É–∂–±—É —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è: 112
   - –°–≤—è–∂–∏—Å—å —Å –±–ª–∏–∑–∫–∏–º–∏ –ª—é–¥—å–º–∏

2. –°–ü–ï–¶–ò–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ü–û–ú–û–©–¨:
   - –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–æ—Ä—è—á–∞—è –ª–∏–Ω–∏—è: 8-800-7000-600
   - –¶–µ–Ω—Ç—Ä—ã –ø–æ–º–æ—â–∏ –∂–µ–Ω—â–∏–Ω–∞–º –≤ –∫—Ä–∏–∑–∏—Å–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
   - –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∑–∞—â–∏—Ç–µ –æ—Ç –¥–æ–º–∞—à–Ω–µ–≥–æ –Ω–∞—Å–∏–ª–∏—è

3. –ü–õ–ê–ù –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:
   - –ü–æ–¥–≥–æ—Ç–æ–≤—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–µ—â–∏
   - –û–ø—Ä–µ–¥–µ–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
   - –°–æ–æ–±—â–∏ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –ª—é–¥—è–º –æ —Å–∏—Ç—É–∞—Ü–∏–∏

–ü–û–ú–ù–ò: –¢–≤–æ—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ.
</urgent_safety_advice>
"""
    
    elif risk_level == "high":
        return """
<high_risk_advice>
–í–´–°–û–ö–ò–ô –†–ò–°–ö - –¢–†–ï–ë–£–Æ–¢–°–Ø –ê–ö–¢–ò–í–ù–´–ï –ú–ï–†–´:

1. –û–¶–ï–ù–ö–ê –°–ò–¢–£–ê–¶–ò–ò:
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã (–¥–∞—Ç—ã, –æ–ø–∏—Å–∞–Ω–∏—è)
   - –°–æ—Ö—Ä–∞–Ω—è–π –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∏ –∑–∞–ø–∏—Å–∏
   - –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —ç—Å–∫–∞–ª–∞—Ü–∏—é

2. –ü–û–î–î–ï–†–ñ–ö–ê:
   - –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
   - –ì—Ä—É–ø–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - –î–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥—Ä—É–∑—å—è –∏ —Å–µ–º—å—è

3. –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï:
   - –†–∞–∑—Ä–∞–±–æ—Ç–∞–π –ø–ª–∞–Ω –Ω–∞ —Å–ª—É—á–∞–π –æ–±–æ—Å—Ç—Ä–µ–Ω–∏—è
   - –ò–∑—É—á–∏ —Å–≤–æ–∏ –ø—Ä–∞–≤–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Ç—É–∞—Ü–∏–∏
</high_risk_advice>
"""
    
    elif risk_level == "medium":
        return """
<medium_risk_advice>
–£–ú–ï–†–ï–ù–ù–´–ô –†–ò–°–ö - –ù–ê–ë–õ–Æ–î–ï–ù–ò–ï –ò –ü–†–û–§–ò–õ–ê–ö–¢–ò–ö–ê:

1. –ú–û–ù–ò–¢–û–†–ò–ù–ì:
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏
   - –í–µ–¥–∏ –¥–Ω–µ–≤–Ω–∏–∫ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
   - –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏

2. –£–ö–†–ï–ü–õ–ï–ù–ò–ï –ì–†–ê–ù–ò–¶:
   - –ß–µ—Ç–∫–æ –≤—ã—Ä–∞–∂–∞–π —Å–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –∑–¥–æ—Ä–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
   - –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã

3. –†–ê–ó–í–ò–¢–ò–ï:
   - –†–∞–±–æ—Ç–∞–π –Ω–∞–¥ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–µ–π –≤ –ø–∞—Ä–µ
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏ –ø–∞—Ä–Ω—É—é —Ç–µ—Ä–∞–ø–∏—é
   - –†–∞–∑–≤–∏–≤–∞–π –ª–∏—á–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
</medium_risk_advice>
"""
    
    else:  # low risk
        return """
<low_risk_advice>
–ù–ò–ó–ö–ò–ô –†–ò–°–ö - –ü–†–û–§–ò–õ–ê–ö–¢–ò–ö–ê –ò –†–ê–ó–í–ò–¢–ò–ï:

1. –ó–î–û–†–û–í–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø:
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –æ—Ç–∫—Ä—ã—Ç—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é
   - –†–∞–∑–≤–∏–≤–∞–π –≤–∑–∞–∏–º–Ω–æ–µ —É–≤–∞–∂–µ–Ω–∏–µ
   - –†–∞–±–æ—Ç–∞–π –Ω–∞–¥ –æ–±—â–∏–º–∏ —Ü–µ–ª—è–º–∏

2. –õ–ò–ß–ù–û–°–¢–ù–´–ô –†–û–°–¢:
   - –†–∞–∑–≤–∏–≤–∞–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
   - –ò–∑—É—á–∞–π –∑–¥–æ—Ä–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å

3. –ü–†–û–§–ò–õ–ê–ö–¢–ò–ö–ê:
   - –ò–∑—É—á–∞–π –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–µ–∑–¥–æ—Ä–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Å–≤—è–∑–∏ —Å –¥—Ä—É–∑—å—è–º–∏ –∏ —Å–µ–º—å–µ–π
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞—â–∞–π—Å—è –∑–∞ –ø–æ–º–æ—â—å—é
</low_risk_advice>
""" 

# Meta-Prompting for Dynamic Prompt Generation
def get_meta_prompt_generator(task_type: str, complexity_level: str, domain: str = "psychology") -> str:
    """
    Meta-prompting function to generate optimized prompts for specific tasks
    """
    
    prompt = f"""
<task>
–°–æ–∑–¥–∞–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∑–∞–¥–∞—á–∏ —Ç–∏–ø–∞ "{task_type}" —Å —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ "{complexity_level}" –≤ –æ–±–ª–∞—Å—Ç–∏ "{domain}".
</task>

<meta_prompting_framework>
–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å:

1. –ß–ï–¢–ö–û–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ó–ê–î–ê–ß–ò
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ü–µ–ª—å
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

2. –ö–û–ù–¢–ï–ö–°–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
   - –†–æ–ª—å –∏ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞
   - –ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

3. –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô –ü–û–î–•–û–î
   - –ü–æ—à–∞–≥–æ–≤–∞—è –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è
   - –ß–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
   - –ü—Ä–∏–º–µ—Ä—ã –∏ —à–∞–±–ª–æ–Ω—ã

4. –ú–ï–•–ê–ù–ò–ó–ú–´ –ö–ê–ß–ï–°–¢–í–ê
   - –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

5. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –í–´–í–û–î–ê
   - –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
   - –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
</meta_prompting_framework>

<prompt_optimization_principles>
–î–ª—è —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ "{task_type}":

–ï–°–õ–ò –∑–∞–¥–∞—á–∞ "–∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞":
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ
- –í–∫–ª—é—á–∏ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- –î–æ–±–∞–≤—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏
- –û–±–µ—Å–ø–µ—á—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–æ–∫

–ï–°–õ–ò –∑–∞–¥–∞—á–∞ "–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ":
- –ü—Ä–∏–º–µ–Ω—è–π —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- –í–∫–ª—é—á–∏ –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–æ–≤
- –î–æ–±–∞–≤—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ï–°–õ–ò –∑–∞–¥–∞—á–∞ "—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å":
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- –û—Ü–µ–Ω–∏–≤–∞–π –∫–æ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–æ—Å—Ç—å
- –í—ã—è–≤–ª—è–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- –ü—Ä–µ–¥–ª–∞–≥–∞–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–ª—É—á—à–µ–Ω–∏—è

–î–ª—è —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ "{complexity_level}":

–ï–°–õ–ò "simple":
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã
- –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

–ï–°–õ–ò "intermediate":
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥

–ï–°–õ–ò "advanced":
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è
- –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑
</prompt_optimization_principles>

<output_format>
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

{{
  "optimized_prompt": "–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞",
  "key_features": ["–∫–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç–∞"],
  "expected_improvements": ["–æ–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è"],
  "token_efficiency": "–æ—Ü–µ–Ω–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤",
  "quality_metrics": ["–º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤"]
}}
</output_format>

–°–æ–∑–¥–∞–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏!
"""

    return prompt

def get_self_refining_prompt(initial_response: str, task_context: str) -> str:
    """
    Constitutional AI inspired self-refining prompt
    """
    
    prompt = f"""
<task>
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ —É–ª—É—á—à–∏ —Å–ª–µ–¥—É—é—â–∏–π –æ—Ç–≤–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–Ω—Ü–∏–ø—ã Constitutional AI.
</task>

<context>
–ò—Å—Ö–æ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: {task_context}
</context>

<initial_response>
{initial_response}
</initial_response>

<constitutional_principles>
1. –¢–û–ß–ù–û–°–¢–¨ –ò –î–û–°–¢–û–í–ï–†–ù–û–°–¢–¨
   - –í—Å–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω—ã
   - –ò–∑–±–µ–≥–∞—Ç—å —Å–ø–µ–∫—É–ª—è—Ü–∏–π –±–µ–∑ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤
   - –ü—Ä–∏–∑–Ω–∞–≤–∞—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å

2. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –≠–¢–ò–ö–ê
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò–∑–±–µ–≥–∞—Ç—å —Å—Ç–∏–≥–º–∞—Ç–∏–∑–∞—Ü–∏–∏
   - –£–≤–∞–∂–µ–Ω–∏–µ –∫ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤—É —á–µ–ª–æ–≤–µ–∫–∞

3. –ü–û–õ–ï–ó–ù–û–°–¢–¨ –ò –ü–†–ê–ö–¢–ò–ß–ù–û–°–¢–¨
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
   - –ü—Ä–∏–º–µ–Ω–∏–º—ã–µ —Å–æ–≤–µ—Ç—ã
   - –ß–µ—Ç–∫–∏–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

4. –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–ò–ó–ú
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—É—á–Ω–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏
   - –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
   - –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã

5. –Ø–°–ù–û–°–¢–¨ –ò –ü–û–ù–Ø–¢–ù–û–°–¢–¨
   - –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
   - –ü–æ–Ω—è—Ç–Ω—ã–π —è–∑—ã–∫
   - –õ–æ–≥–∏—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
</constitutional_principles>

<self_reflection_questions>
1. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Ç–æ—á–µ–Ω –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω –∞–Ω–∞–ª–∏–∑?
2. –í—Å–µ –ª–∏ –∞—Å–ø–µ–∫—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —É—á—Ç–µ–Ω—ã?
3. –ù–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏?
4. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º?
5. –ü–æ–Ω—è—Ç–µ–Ω –ª–∏ –æ—Ç–≤–µ—Ç —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏?
6. –ï—Å—Ç—å –ª–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏?
7. –ú–æ–∂–Ω–æ –ª–∏ —É–ª—É—á—à–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç?
</self_reflection_questions>

<improvement_process>
–®–∞–≥ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
- –í—ã—è–≤–∏ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- –û–ø—Ä–µ–¥–µ–ª–∏ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º

–®–∞–≥ 2: –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
- –î–æ–±–∞–≤—å –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ò—Å–ø—Ä–∞–≤—å –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏
- –£—Å–∏–ª—å –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—é

–®–∞–≥ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –£–ª—É—á—à–∏ –ª–æ–≥–∏—á–µ—Å–∫—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –°–¥–µ–ª–∞–π –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º
- –î–æ–±–∞–≤—å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏

–®–∞–≥ 4: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- –£–±–µ–¥–∏—Å—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
- –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å
- –û—Ü–µ–Ω–∏ –æ–±—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
</improvement_process>

<output_format>
{{
  "analysis_of_original": "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞",
  "identified_issues": ["–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã"],
  "improvements_made": ["–≤–Ω–µ—Å–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è"],
  "refined_response": "—É–ª—É—á—à–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç",
  "quality_assessment": "–æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞",
  "confidence_level": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1
}}
</output_format>

–ü—Ä–æ–≤–µ–¥–∏ —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –æ—Ç–≤–µ—Ç!
"""

    return prompt 