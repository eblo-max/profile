import asyncio
import random
import re
from app.services.ai_service import AIService
from app.core.config import settings
import time

def get_detailed_questionnaire():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∫–µ—Ç—É —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏"""
    return {
        "q1": {
            "question": "–ö–∞–∫ –≤–∞—à –ø–∞—Ä—Ç–Ω–µ—Ä —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –≤–∞—à–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ø–µ—Ö–∏?",
            "options": [
                "–ò—Å–∫—Ä–µ–Ω–Ω–µ —Ä–∞–¥—É–µ—Ç—Å—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–Ω—è",
                "–°–Ω–∞—á–∞–ª–∞ –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ—Ç, –Ω–æ –ø–æ—Ç–æ–º –Ω–∞—Ö–æ–¥–∏—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã",
                "–ü–µ—Ä–µ–≤–æ–¥–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –Ω–∞ —Å–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
                "–ü—Ä–∏–Ω–∏–∂–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å –º–æ–∏—Ö —É—Å–ø–µ—Ö–æ–≤ —Å–ª–æ–≤–∞–º–∏ –≤—Ä–æ–¥–µ '—ç—Ç–æ –Ω–µ —Ç–∞–∫ —Å–ª–æ–∂–Ω–æ'",
                "–û–±–≤–∏–Ω—è–µ—Ç –º–µ–Ω—è –≤ —Ç–æ–º, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ –≤–∞–∂–Ω–µ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π"
            ]
        },
        "q2": {
            "question": "–ö–∞–∫ –æ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤–∞—à–∏ —Ñ–∏–Ω–∞–Ω—Å—ã?",
            "options": [
                "–ú—ã —Å–æ–≤–º–µ—Å—Ç–Ω–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º –±—é–¥–∂–µ—Ç –∫–∞–∫ —Ä–∞–≤–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã",
                "–û–Ω –¥–∞–µ—Ç —Å–æ–≤–µ—Ç—ã, –Ω–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é —è",
                "–ù–∞—Å—Ç–∞–∏–≤–∞–µ—Ç –Ω–∞ —Ç–æ–º, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å –≤—Å–µ –º–æ–∏ —Ç—Ä–∞—Ç—ã",
                "–¢—Ä–µ–±—É–µ—Ç –æ—Ç—á–µ—Ç–∞ –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–∫—É–ø–∫—É –∏ —á–µ–∫–∏",
                "–î–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–µ–Ω—å–≥–∏ —É —Å–µ–±—è, —è –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Å–∏—Ç—å –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã"
            ]
        },
        "q3": {
            "question": "–ö–∞–∫ –æ–Ω –≤–µ–¥–µ—Ç —Å–µ–±—è –≤–æ –≤—Ä–µ–º—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤?",
            "options": [
                "–°–ø–æ–∫–æ–π–Ω–æ –æ–±—Å—É–∂–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∏ –∏—â–µ—Ç –∫–æ–º–ø—Ä–æ–º–∏—Å—Å",
                "–ü–æ–≤—ã—à–∞–µ—Ç –≥–æ–ª–æ—Å, –Ω–æ –ø–æ—Ç–æ–º –∏–∑–≤–∏–Ω—è–µ—Ç—Å—è",
                "–ö—Ä–∏—á–∏—Ç –∏ –æ–±–≤–∏–Ω—è–µ—Ç –º–µ–Ω—è –≤–æ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö",
                "–û—Å–∫–æ—Ä–±–ª—è–µ—Ç –º–µ–Ω—è —Å–ª–æ–≤–∞–º–∏ '—Ç—ã –≥–ª—É–ø–∞—è', '—Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å'",
                "–ú–æ–∂–µ—Ç —É–≥—Ä–æ–∂–∞—Ç—å —Ä–∞–∑—Ä—ã–≤–æ–º –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–≥—Ä–µ—Å—Å–∏–µ–π"
            ]
        },
        "q4": {
            "question": "–ö–∞–∫ –æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≤–∞—à–∏–º –¥—Ä—É–∑—å—è–º –∏ —Å–µ–º—å–µ?",
            "options": [
                "–•–æ—Ä–æ—à–æ –ª–∞–¥–∏—Ç —Å–æ –≤—Å–µ–º–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–æ–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
                "–¢–µ—Ä–ø–∏—Ç –∏—Ö, –Ω–æ –∏–Ω–æ–≥–¥–∞ –¥–µ–ª–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è",
                "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –≤ –º–æ–∏—Ö –±–ª–∏–∑–∫–∏—Ö",
                "–ì–æ–≤–æ—Ä–∏—Ç —á—Ç–æ –æ–Ω–∏ '–ø–ª–æ—Ö–æ –Ω–∞ –º–µ–Ω—è –≤–ª–∏—è—é—Ç' –∏ '–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –ø—Ä–æ—Ç–∏–≤ –Ω–µ–≥–æ'",
                "–ó–∞–ø—Ä–µ—â–∞–µ—Ç –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏ –∏ —Å–µ–º—å–µ–π"
            ]
        },
        "q5": {
            "question": "–ö–∞–∫ –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞—à—É –ø–µ—Ä–µ–ø–∏—Å–∫—É –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏?",
            "options": [
                "–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç",
                "–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å–∏—Ç –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
                "–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –º–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ñ–æ—Ç–æ",
                "–¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª–∏ –æ—Ç –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ '—É –Ω–∞—Å –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–µ–∫—Ä–µ—Ç–æ–≤'",
                "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–ª–µ–¥–∏—Ç –∑–∞ –º–æ–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∏ —Ç—Ä–µ–±—É–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–π"
            ]
        },
        "q6": {
            "question": "–ö–∞–∫ –æ–Ω —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –≤–∞—à–∏ –ø—Ä–æ—Å—å–±—ã –æ –ª–∏—á–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏?",
            "options": [
                "–ü–æ–Ω–∏–º–∞–µ—Ç –∏ —É–≤–∞–∂–∞–µ—Ç –º–æ—é –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ",
                "–°–æ–≥–ª–∞—à–∞–µ—Ç—Å—è, –Ω–æ –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ–±–∏–∂–∞—Ç—å—Å—è",
                "–í–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ –æ—Ç–≤–µ—Ä–∂–µ–Ω–∏–µ –∏ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—Ü–µ–Ω—ã",
                "–ì–æ–≤–æ—Ä–∏—Ç '–µ—Å–ª–∏ –ª—é–±–∏—à—å, —Ç–æ —Ö–æ—á–µ—à—å –±—ã—Ç—å —Å–æ –º–Ω–æ–π –≤—Å–µ–≥–¥–∞'",
                "–ü—Ä–µ—Å–ª–µ–¥—É–µ—Ç –º–µ–Ω—è –∏ –Ω–µ –¥–∞–µ—Ç –ø–æ–±—ã—Ç—å –æ–¥–Ω–æ–π"
            ]
        },
        "q7": {
            "question": "–ö–∞–∫ –æ–Ω –≤–µ–¥–µ—Ç —Å–µ–±—è –≤ –æ–±—â–µ—Å—Ç–≤–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥–æ–º–æ–º?",
            "options": [
                "–û–¥–∏–Ω–∞–∫–æ–≤–æ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ –≤–µ–∑–¥–µ",
                "–ù–µ–º–Ω–æ–≥–æ –±–æ–ª–µ–µ —Å–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –Ω–∞ –ø—É–±–ª–∏–∫–µ",
                "–ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è - –º–∏–ª —Å –¥—Ä—É–≥–∏–º–∏, –≥—Ä—É–± —Å–æ –º–Ω–æ–π",
                "–ü—Ä–∏ –ª—é–¥—è—Ö –∏–∑–æ–±—Ä–∞–∂–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º—É–∂–∞, –¥–æ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º",
                "–ú–æ–∂–µ—Ç —É–Ω–∏–∂–∞—Ç—å –º–µ–Ω—è –¥–∞–∂–µ –ø—Ä–∏ –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö"
            ]
        },
        "q8": {
            "question": "–ö–∞–∫ –æ–Ω —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫—Ä–∏—Ç–∏–∫—É —Å –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã?",
            "options": [
                "–í—ã—Å–ª—É—à–∏–≤–∞–µ—Ç –∏ –≥–æ—Ç–æ–≤ –æ–±—Å—É–∂–¥–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã",
                "–ó–∞—â–∏—â–∞–µ—Ç—Å—è, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–∑–Ω–∞—Ç—å –æ—à–∏–±–∫–∏",
                "–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç –ª—é–±—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è",
                "–ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é: '—ç—Ç–æ —Ç—ã –≤–æ –≤—Å–µ–º –≤–∏–Ω–æ–≤–∞—Ç–∞'",
                "–ù–∞–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—è —Ö–æ–ª–æ–¥–Ω–æ—Å—Ç—å—é –∏–ª–∏ —É–≥—Ä–æ–∑–∞–º–∏ –∑–∞ –∫—Ä–∏—Ç–∏–∫—É"
            ]
        },
        "q9": {
            "question": "–ö–∞–∫ –æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≤–∞—à–µ–º—É '–Ω–µ—Ç' –≤ –∏–Ω—Ç–∏–º–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö?",
            "options": [
                "–£–≤–∞–∂–∞–µ—Ç –º–æ–∏ –≥—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤",
                "–†–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
                "–û–±–∏–∂–∞–µ—Ç—Å—è –∏ –≥–æ–≤–æ—Ä–∏—Ç —á—Ç–æ —è '—Ö–æ–ª–æ–¥–Ω–∞—è' –∏ '–Ω–µ –ª—é–±–ª—é –µ–≥–æ'",
                "–ü—Ä–∏–Ω—É–∂–¥–∞–µ—Ç —á–µ—Ä–µ–∑ —Ñ—Ä–∞–∑—ã '–µ—Å–ª–∏ –ª—é–±–∏—à—å, —Ç–æ –Ω–µ –æ—Ç–∫–∞–∂–µ—à—å'",
                "–ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –º–æ–π –æ—Ç–∫–∞–∑ –∏ –Ω–∞—Å—Ç–∞–∏–≤–∞–µ—Ç –Ω–∞ —Å–≤–æ–µ–º"
            ]
        },
        "q10": {
            "question": "–ö–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–∏—Ö —Å–ª–∞–±–æ—Å—Ç—è—Ö?",
            "options": [
                "–ü–æ–º–æ–≥–∞–µ—Ç –º–Ω–µ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏",
                "–ò–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –Ω–µ–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—å –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É",
                "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–∏ —Å–ª–∞–±–æ—Å—Ç–∏ –≤ —Å–ø–æ—Ä–∞—Ö –ø—Ä–æ—Ç–∏–≤ –º–µ–Ω—è",
                "–¶–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ –¥–∞–≤–∏—Ç –Ω–∞ –±–æ–ª–µ–≤—ã–µ —Ç–æ—á–∫–∏ –≤–æ –≤—Ä–µ–º—è —Å—Å–æ—Ä",
                "–£–≥—Ä–æ–∂–∞–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–∏–º –º–æ–∏ —Å–µ–∫—Ä–µ—Ç—ã"
            ]
        }
    }

def generate_realistic_answers():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å—é"""
    questionnaire = get_detailed_questionnaire()
    answers = []
    
    # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–∫—Å–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
    toxic_answers = [
        "–ü–µ—Ä–µ–≤–æ–¥–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –Ω–∞ —Å–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
        "–î–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–µ–Ω—å–≥–∏ —É —Å–µ–±—è, —è –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Å–∏—Ç—å –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã", 
        "–û—Å–∫–æ—Ä–±–ª—è–µ—Ç –º–µ–Ω—è —Å–ª–æ–≤–∞–º–∏ '—Ç—ã –≥–ª—É–ø–∞—è', '—Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å'",
        "–ì–æ–≤–æ—Ä–∏—Ç —á—Ç–æ –æ–Ω–∏ '–ø–ª–æ—Ö–æ –Ω–∞ –º–µ–Ω—è –≤–ª–∏—è—é—Ç' –∏ '–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –ø—Ä–æ—Ç–∏–≤ –Ω–µ–≥–æ'",
        "–¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª–∏ –æ—Ç –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ '—É –Ω–∞—Å –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–µ–∫—Ä–µ—Ç–æ–≤'",
        "–ì–æ–≤–æ—Ä–∏—Ç '–µ—Å–ª–∏ –ª—é–±–∏—à—å, —Ç–æ —Ö–æ—á–µ—à—å –±—ã—Ç—å —Å–æ –º–Ω–æ–π –≤—Å–µ–≥–¥–∞'",
        "–ü—Ä–∏ –ª—é–¥—è—Ö –∏–∑–æ–±—Ä–∞–∂–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º—É–∂–∞, –¥–æ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º",
        "–ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é: '—ç—Ç–æ —Ç—ã –≤–æ –≤—Å–µ–º –≤–∏–Ω–æ–≤–∞—Ç–∞'",
        "–ü—Ä–∏–Ω—É–∂–¥–∞–µ—Ç —á–µ—Ä–µ–∑ —Ñ—Ä–∞–∑—ã '–µ—Å–ª–∏ –ª—é–±–∏—à—å, —Ç–æ –Ω–µ –æ—Ç–∫–∞–∂–µ—à—å'",
        "–¶–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ –¥–∞–≤–∏—Ç –Ω–∞ –±–æ–ª–µ–≤—ã–µ —Ç–æ—á–∫–∏ –≤–æ –≤—Ä–µ–º—è —Å—Å–æ—Ä"
    ]
    
    for i, (q_id, q_data) in enumerate(questionnaire.items()):
        if i < len(toxic_answers):
            selected_answer = toxic_answers[i]
        else:
            # –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç–æ–∫—Å–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç
            weights = [0.05, 0.15, 0.25, 0.35, 0.20]  # –ë–æ–ª—å—à–µ –≤–µ—Å–∞ –Ω–∞ —Ç–æ–∫—Å–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            selected_index = random.choices(range(len(q_data["options"])), weights=weights)[0]
            selected_answer = q_data["options"][selected_index]
        
        answers.append({
            "question": q_data["question"],
            "answer": selected_answer,
            "question_id": q_id
        })
    
    return answers

def generate_partner_profile():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞"""
    profiles = [
        {
            "name": "–î–º–∏—Ç—Ä–∏–π",
            "age": 32,
            "profession": "–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º",
            "description": "–î–º–∏—Ç—Ä–∏–π, 32 –≥–æ–¥–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –≤ –∫—Ä—É–ø–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏"
        },
        {
            "name": "–ê–ª–µ–∫—Å–µ–π", 
            "age": 29,
            "profession": "–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å",
            "description": "–ê–ª–µ–∫—Å–µ–π, 29 –ª–µ—Ç, –≤–ª–∞–¥–µ–ª–µ—Ü –Ω–µ–±–æ–ª—å—à–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞"
        },
        {
            "name": "–°–µ—Ä–≥–µ–π",
            "age": 35,
            "profession": "IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
            "description": "–°–µ—Ä–≥–µ–π, 35 –ª–µ—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º –≤ IT-–∫–æ–º–ø–∞–Ω–∏–∏"
        }
    ]
    
    return random.choice(profiles)

def analyze_quality(result, partner_name):
    """–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ—Ä—Ç—Ä–µ—Ç–∞"""
    profile_text = result.get('psychological_profile', '')
    word_count = len(profile_text.split())
    
    quality_score = 0
    max_score = 120
    
    print(f"\nüìä –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–ê–ß–ï–°–¢–í–ê:")
    print("=" * 60)
    
    # 1. –û–±—ä–µ–º (25 –±–∞–ª–ª–æ–≤)
    print(f"1. –û–ë–™–ï–ú –ê–ù–ê–õ–ò–ó–ê:")
    print(f"   –°–ª–æ–≤: {word_count}")
    print(f"   –°–∏–º–≤–æ–ª–æ–≤: {len(profile_text)}")
    
    if word_count >= 2200:
        quality_score += 25
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: {word_count} —Å–ª–æ–≤ (—Ü–µ–ª—å: 2200-2500)")
    elif word_count >= 1800:
        quality_score += 20
        print(f"   üü° –•–û–†–û–®–û: {word_count} —Å–ª–æ–≤ (–±–ª–∏–∑–∫–æ –∫ —Ü–µ–ª–∏)")
    elif word_count >= 1400:
        quality_score += 15
        print(f"   üü† –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û: {word_count} —Å–ª–æ–≤")
    else:
        quality_score += 5
        print(f"   üî¥ –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û: {word_count} —Å–ª–æ–≤")
    
    # 2. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è - —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏–º–µ–Ω–∏ (20 –±–∞–ª–ª–æ–≤)
    name_mentions = profile_text.count(partner_name)
    print(f"\n2. –ü–ï–†–°–û–ù–ê–õ–ò–ó–ê–¶–ò–Ø:")
    print(f"   –£–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏–º–µ–Ω–∏ '{partner_name}': {name_mentions}")
    
    if name_mentions >= 8:
        quality_score += 20
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: {name_mentions} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π (—Ü–µ–ª—å: 8-10)")
    elif name_mentions >= 5:
        quality_score += 15
        print(f"   üü° –•–û–†–û–®–û: {name_mentions} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π")
    elif name_mentions >= 2:
        quality_score += 10
        print(f"   üü† –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û: {name_mentions} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π")
    else:
        quality_score += 0
        print(f"   üî¥ –ü–õ–û–•–û: {name_mentions} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π")
    
    # 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ —Å–º–∞–π–ª–∏–∫–æ–≤ (15 –±–∞–ª–ª–æ–≤)
    emoji_count = len(re.findall(r'[üòÄ-üôø]|[üöÄ-üõø]|[‚òÄ-‚õø]', profile_text))
    hash_count = profile_text.count('#')
    print(f"\n3. –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê:")
    print(f"   –°–º–∞–π–ª–∏–∫–æ–≤: {emoji_count}")
    print(f"   –†–µ—à–µ—Ç–æ–∫: {hash_count}")
    
    if emoji_count == 0 and hash_count == 0:
        quality_score += 15
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: –ß–∏—Å—Ç—ã–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç")
    elif emoji_count <= 2 and hash_count <= 2:
        quality_score += 10
        print(f"   üü° –•–û–†–û–®–û: –ú–∏–Ω–∏–º—É–º –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤")
    else:
        quality_score += 5
        print(f"   üî¥ –ü–õ–û–•–û: –ú–Ω–æ–≥–æ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤")
    
    # 4. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å –∏–º–µ–Ω–∞–º–∏ (20 –±–∞–ª–ª–æ–≤)
    example_names = ['–ê–Ω–Ω–∞', '–ú–∞—Ä–∏–Ω–∞', '–ï–ª–µ–Ω–∞', '–û–ª—å–≥–∞', '–°–≤–µ—Ç–ª–∞–Ω–∞', '–ò—Ä–∏–Ω–∞', '–ù–∞—Ç–∞–ª—å—è', '–¢–∞—Ç—å—è–Ω–∞', '–í–∏–∫—Ç–æ—Ä–∏—è']
    found_names = [name for name in example_names if name in profile_text]
    print(f"\n4. –ö–û–ù–ö–†–ï–¢–ù–´–ï –ü–†–ò–ú–ï–†–´:")
    print(f"   –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞: {found_names}")
    print(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {len(found_names)}")
    
    if len(found_names) >= 5:
        quality_score += 20
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: {len(found_names)} –ø—Ä–∏–º–µ—Ä–æ–≤")
    elif len(found_names) >= 3:
        quality_score += 15
        print(f"   üü° –•–û–†–û–®–û: {len(found_names)} –ø—Ä–∏–º–µ—Ä–æ–≤")
    elif len(found_names) >= 1:
        quality_score += 10
        print(f"   üü† –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û: {len(found_names)} –ø—Ä–∏–º–µ—Ä–æ–≤")
    else:
        quality_score += 0
        print(f"   üî¥ –ü–õ–û–•–û: –ù–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤")
    
    # 5. –ù–∞—É—á–Ω–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è (15 –±–∞–ª–ª–æ–≤)
    scientific_terms = [
        '–Ω–∞—Ä—Ü–∏—Å—Å–∏–∑–º', '–≥–∞–∑–ª–∞–π—Ç–∏–Ω–≥', '–º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è', '–ø—Ä–æ–µ–∫—Ü–∏—è', '—Ç—Ä–∏–∞–¥–∞',
        '–º–∞–∫–∏–∞–≤–µ–ª–ª–∏–∑–º', '–ø—Å–∏—Ö–æ–ø–∞—Ç–∏—è', '–¥–∏–∑—Ä–µ–≥—É–ª—è—Ü–∏—è', '–∞–±—å—é–∑', '—Ç—Ä–∞–≤–º–∞'
    ]
    found_terms = [term for term in scientific_terms if term.lower() in profile_text.lower()]
    print(f"\n5. –ù–ê–£–ß–ù–ê–Ø –¢–ï–†–ú–ò–ù–û–õ–û–ì–ò–Ø:")
    print(f"   –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã: {found_terms}")
    print(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {len(found_terms)}")
    
    if len(found_terms) >= 6:
        quality_score += 15
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: {len(found_terms)} —Ç–µ—Ä–º–∏–Ω–æ–≤")
    elif len(found_terms) >= 4:
        quality_score += 12
        print(f"   üü° –•–û–†–û–®–û: {len(found_terms)} —Ç–µ—Ä–º–∏–Ω–æ–≤")
    elif len(found_terms) >= 2:
        quality_score += 8
        print(f"   üü† –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û: {len(found_terms)} —Ç–µ—Ä–º–∏–Ω–æ–≤")
    else:
        quality_score += 0
        print(f"   üî¥ –ü–õ–û–•–û: –ú–∞–ª–æ –Ω–∞—É—á–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤")
    
    # 6. –¶–∏—Ç–∞—Ç—ã –∏ –¥–∏–∞–ª–æ–≥–∏ (15 –±–∞–ª–ª–æ–≤)
    quote_count = profile_text.count('"') + profile_text.count("'")
    print(f"\n6. –¶–ò–¢–ê–¢–´ –ò –î–ò–ê–õ–û–ì–ò:")
    print(f"   –ö–∞–≤—ã—á–µ–∫ –Ω–∞–π–¥–µ–Ω–æ: {quote_count}")
    
    if quote_count >= 20:
        quality_score += 15
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: {quote_count} –∫–∞–≤—ã—á–µ–∫ (–º–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤)")
    elif quote_count >= 10:
        quality_score += 12
        print(f"   üü° –•–û–†–û–®–û: {quote_count} –∫–∞–≤—ã—á–µ–∫")
    elif quote_count >= 5:
        quality_score += 8
        print(f"   üü† –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û: {quote_count} –∫–∞–≤—ã—á–µ–∫")
    else:
        quality_score += 0
        print(f"   üî¥ –ü–õ–û–•–û: –ú–∞–ª–æ –¥–∏–∞–ª–æ–≥–æ–≤")
    
    # 7. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (10 –±–∞–ª–ª–æ–≤)
    sentences = profile_text.split('.')
    unique_sentences = len(set(sentence.strip() for sentence in sentences if sentence.strip()))
    print(f"\n7. –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–¨ –ö–û–ù–¢–ï–ù–¢–ê:")
    print(f"   –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: {unique_sentences}")
    
    if unique_sentences >= 80:
        quality_score += 10
        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: –í—ã—Å–æ–∫–∞—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å")
    elif unique_sentences >= 60:
        quality_score += 8
        print(f"   üü° –•–û–†–û–®–û: –°—Ä–µ–¥–Ω—è—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å")
    else:
        quality_score += 5
        print(f"   üü† –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û: –ù–∏–∑–∫–∞—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å")
    
    print(f"\nüìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê: {quality_score}/{max_score} ({quality_score/max_score*100:.1f}%)")
    
    if quality_score >= 100:
        print("üèÜ –ü–†–ï–í–û–°–•–û–î–ù–û! –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç")
    elif quality_score >= 80:
        print("üéâ –û–¢–õ–ò–ß–ù–û! –í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑")
    elif quality_score >= 60:
        print("üü° –•–û–†–û–®–û! –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –Ω–µ–¥–æ—á–µ—Ç–∞–º–∏")
    else:
        print("üî¥ –¢–†–ï–ë–£–ï–¢ –£–õ–£–ß–®–ï–ù–ò–ô! –ú–Ω–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤")
    
    return quality_score, max_score

async def test_professional_analysis():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑"""
    print("üéØ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç...")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    partner_profile = generate_partner_profile()
    answers = generate_realistic_answers()
    
    print(f"\nüë§ –ü–†–û–§–ò–õ–¨ –ü–ê–†–¢–ù–ï–†–ê:")
    print(f"–ò–º—è: {partner_profile['name']}")
    print(f"–í–æ–∑—Ä–∞—Å—Ç: {partner_profile['age']} –ª–µ—Ç")
    print(f"–ü—Ä–æ—Ñ–µ—Å—Å–∏—è: {partner_profile['profession']}")
    
    print(f"\nüìù –ü–†–ò–ú–ï–†–´ –¢–û–ö–°–ò–ß–ù–´–• –û–¢–í–ï–¢–û–í:")
    print("=" * 60)
    for i, answer in enumerate(answers[:3], 1):
        print(f"{i}. {answer['question']}")
        print(f"   –û—Ç–≤–µ—Ç: {answer['answer']}")
        print()
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º AI
    ai_service = AIService()
    
    print(f"ü§ñ –ó–∞–ø—É—Å–∫–∞—é –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑...")
    start_time = time.time()
    
    try:
        result = await ai_service.profile_partner(
            answers=answers,
            user_id=999,
            partner_name=partner_profile['name'],
            partner_description=partner_profile['description'],
            use_cache=False
        )
        
        analysis_time = time.time() - start_time
        
        print(f"‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ {analysis_time:.2f} —Å–µ–∫—É–Ω–¥")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        profile_text = result.get('psychological_profile', '')
        
        print(f"\nüìñ –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ü–û–†–¢–†–ï–¢:")
        print("=" * 80)
        print(profile_text)
        print("=" * 80)
        
        # –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞
        quality_score, max_score = analyze_quality(result, partner_profile['name'])
        
        return result, quality_score, max_score, analysis_time
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()
        return None, 0, 120, 0

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê")
    print("=" * 80)
    
    result, score, max_score, time_taken = await test_professional_analysis()
    
    if result:
        print("\n" + "=" * 80)
        print("üéØ –ò–¢–û–ì–ò –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
        print("=" * 80)
        
        percentage = (score / max_score) * 100
        print(f"üìä –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: {score}/{max_score} ({percentage:.1f}%)")
        print(f"‚è±Ô∏è –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: {time_taken:.2f} —Å–µ–∫—É–Ω–¥")
        print(f"üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ~${result.get('cost_estimate', 0.15)}")
        
        if percentage >= 85:
            print("üèÜ –°–ò–°–¢–ï–ú–ê –ò–î–ï–ê–õ–¨–ù–ê! –ì–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!")
        elif percentage >= 70:
            print("üéâ –û–¢–õ–ò–ß–ù–û! –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ!")
        elif percentage >= 55:
            print("üü° –•–û–†–û–®–û! –ï—Å—Ç—å –º–µ—Å—Ç–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π")
        else:
            print("üî¥ –¢–†–ï–ë–£–ï–¢ –î–û–†–ê–ë–û–¢–ö–ò! –ú–Ω–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤")

if __name__ == "__main__":
    asyncio.run(main()) 