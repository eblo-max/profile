#!/usr/bin/env python3

import asyncio
import os
import sys
from datetime import datetime

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from app.services.ai_service import AIService
from app.services.html_pdf_service import HTMLPDFService

# –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ - —Ç–æ–∫—Å–∏—á–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä
HIGH_RISK_ANSWERS = [
    {"question": "–ö–æ–Ω—Ç—Ä–æ–ª—å", "answer": "–î–∞, –æ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è"},
    {"question": "–ö—Ä–∏—Ç–∏–∫–∞", "answer": "–î–∞, –æ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∫—Ä–∏—Ç–∏–∫—É–µ—Ç –º–µ–Ω—è"},
    {"question": "–ò–∑–æ–ª—è—Ü–∏—è", "answer": "–î–∞, –æ–Ω –∑–∞–ø—Ä–µ—â–∞–µ—Ç –º–Ω–µ –≤–∏–¥–µ—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏"},
    {"question": "–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏", "answer": "–î–∞, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —à–∞–Ω—Ç–∞–∂"},
    {"question": "–ê–≥—Ä–µ—Å—Å–∏—è", "answer": "–î–∞, –æ–Ω –º–æ–∂–µ—Ç –∫—Ä–∏—á–∞—Ç—å –∏ —É–≥—Ä–æ–∂–∞—Ç—å"},
    {"question": "–†–µ–≤–Ω–æ—Å—Ç—å", "answer": "–î–∞, –æ–Ω –ø–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–µ–≤–Ω–∏–≤"},
    {"question": "–£–Ω–∏–∂–µ–Ω–∏–µ", "answer": "–î–∞, –æ–Ω —É–Ω–∏–∂–∞–µ—Ç –º–µ–Ω—è –ø—É–±–ª–∏—á–Ω–æ"},
    {"question": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å", "answer": "–î–∞, –æ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–Ω—å–≥–∏"},
    {"question": "–ì–∞–∑–ª–∞–π—Ç–∏–Ω–≥", "answer": "–î–∞, –æ–Ω –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω—è —Å–æ–º–Ω–µ–≤–∞—Ç—å—Å—è –≤ —Å–µ–±–µ"},
    {"question": "–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç —Å–µ–º—å–∏", "answer": "–î–∞, –æ–Ω –Ω–∞—Å—Ç—Ä–æ–∏–ª –º–µ–Ω—è –ø—Ä–æ—Ç–∏–≤ —Å–µ–º—å–∏"}
]

# –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ - –∑–¥–æ—Ä–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è
LOW_RISK_ANSWERS = [
    {"question": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞", "answer": "–î–∞, –æ–Ω –≤—Å–µ–≥–¥–∞ –º–µ–Ω—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç"},
    {"question": "–£–≤–∞–∂–µ–Ω–∏–µ", "answer": "–î–∞, –æ–Ω —É–≤–∞–∂–∞–µ—Ç –º–æ–∏ –≥—Ä–∞–Ω–∏—Ü—ã"},
    {"question": "–û–±—â–µ–Ω–∏–µ", "answer": "–î–∞, –º—ã –æ—Ç–∫—Ä—ã—Ç–æ –æ–±—Å—É–∂–¥–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã"},
    {"question": "–î–æ–≤–µ—Ä–∏–µ", "answer": "–î–∞, –º–µ–∂–¥—É –Ω–∞–º–∏ –ø–æ–ª–Ω–æ–µ –¥–æ–≤–µ—Ä–∏–µ"},
    {"question": "–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å", "answer": "–î–∞, —è —Å–≤–æ–±–æ–¥–Ω–∞ –≤ —Å–≤–æ–∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö"},
    {"question": "–î—Ä—É–∑—å—è", "answer": "–î–∞, –æ–Ω —Ä–∞–¥ –º–æ–∏–º –¥—Ä—É–∂–µ—Å–∫–∏–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º"},
    {"question": "–°–µ–º—å—è", "answer": "–î–∞, –æ–Ω —Ö–æ—Ä–æ—à–æ –ª–∞–¥–∏—Ç —Å –º–æ–µ–π —Å–µ–º—å–µ–π"},
    {"question": "–§–∏–Ω–∞–Ω—Å—ã", "answer": "–î–∞, –º—ã —Å–æ–≤–º–µ—Å—Ç–Ω–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º –±—é–¥–∂–µ—Ç"},
    {"question": "–≠–º–æ—Ü–∏–∏", "answer": "–î–∞, –æ–Ω –ø–æ–Ω–∏–º–∞–µ—Ç –º–æ–∏ —á—É–≤—Å—Ç–≤–∞"},
    {"question": "–†–∞–∑–≤–∏—Ç–∏–µ", "answer": "–î–∞, –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–æ–∏ —Ü–µ–ª–∏"}
]

async def test_different_risk_levels():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É—é –±–µ—Å—à–æ–≤–Ω—ã–π PDF –¥–∏–∑–∞–π–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π —Ä–∏—Å–∫–∞...")
    
    ai_service = AIService()
    pdf_service = HTMLPDFService()
    
    # –¢–µ—Å—Ç 1: –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ (—Ç–æ–∫—Å–∏—á–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä)
    print("\n1Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤—ã—Å–æ–∫–æ—Ä–∏—Å–∫–æ–≤—ã–π –æ—Ç—á–µ—Ç...")
    
    high_risk_analysis = await ai_service.profile_partner(
        user_id=999,
        answers=HIGH_RISK_ANSWERS,
        partner_name="–¢–æ–∫—Å–∏—á–Ω—ã–π –ü–∞—Ä—Ç–Ω–µ—Ä"
    )
    
    print(f"‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞: {high_risk_analysis['manipulation_risk']:.1f}%")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF
    high_risk_pdf = await pdf_service.generate_partner_report_html(
        analysis_data=high_risk_analysis,
        user_id=999,
        partner_name="–¢–æ–∫—Å–∏—á–Ω—ã–π –ü–∞—Ä—Ç–Ω–µ—Ä"
    )
    
    with open("seamless_high_risk.pdf", "wb") as f:
        f.write(high_risk_pdf)
    
    print(f"‚úÖ –í—ã—Å–æ–∫–æ—Ä–∏—Å–∫–æ–≤—ã–π PDF: {len(high_risk_pdf)/(1024*1024):.1f}MB")
    
    # –¢–µ—Å—Ç 2: –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ (–∑–¥–æ—Ä–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è)
    print("\n2Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –Ω–∏–∑–∫–æ—Ä–∏—Å–∫–æ–≤—ã–π –æ—Ç—á–µ—Ç...")
    
    low_risk_analysis = await ai_service.profile_partner(
        user_id=998,
        answers=LOW_RISK_ANSWERS,
        partner_name="–ó–¥–æ—Ä–æ–≤—ã–π –ü–∞—Ä—Ç–Ω–µ—Ä"
    )
    
    print(f"‚úÖ –ê–Ω–∞–ª–∏–∑ –Ω–∏–∑–∫–æ–≥–æ —Ä–∏—Å–∫–∞: {low_risk_analysis['manipulation_risk']:.1f}%")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF
    low_risk_pdf = await pdf_service.generate_partner_report_html(
        analysis_data=low_risk_analysis,
        user_id=998,
        partner_name="–ó–¥–æ—Ä–æ–≤—ã–π –ü–∞—Ä—Ç–Ω–µ—Ä"
    )
    
    with open("seamless_low_risk.pdf", "wb") as f:
        f.write(low_risk_pdf)
    
    print(f"‚úÖ –ù–∏–∑–∫–æ—Ä–∏—Å–∫–æ–≤—ã–π PDF: {len(low_risk_pdf)/(1024*1024):.1f}MB")
    
    print("\nüéâ –ë–µ—Å—à–æ–≤–Ω—ã–µ PDF –≥–æ—Ç–æ–≤—ã!")
    print("üî¥ seamless_high_risk.pdf - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ —Å –∫—Ä–∞—Å–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º")
    print("üü¢ seamless_low_risk.pdf - –∑–¥–æ—Ä–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –∑–µ–ª–µ–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º")
    print("\nüìã –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:")
    print("   ‚Ä¢ –ë–µ—Å—à–æ–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü")
    print("   ‚Ä¢ –¶–≤–µ—Ç–æ–≤–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é —Ä–∏—Å–∫–∞")
    print("   ‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –∏ layout")
    print("   ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã")
    print("   ‚Ä¢ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤")

if __name__ == "__main__":
    asyncio.run(test_different_risk_levels()) 